{% extends "base.html" %}

{% block title %}Edit Your Profile - Hikmat Hub{% endblock %}

{% block content %}
<div class="form-container edit-profile-form">
    <h2><i class="fas fa-user-edit mr-2"></i>Edit Your Profile</h2>
    <p>Update your personal information and password.</p>

    <form method="POST" action="{{ url_for('edit_profile') }}">
        {{ form.hidden_tag() }} {# CSRF token #}

        <fieldset class="form-fieldset">
            <legend>Basic Information</legend>
            <div class="form-group">
                {{ form.username.label(class="form-label") }}
                {{ form.username(class="form-control", placeholder="Your unique username") }}
                {% if form.username.errors %}
                    {% for error in form.username.errors %}<span class="form-error">{{ error }}</span>{% endfor %}
                {% endif %}
            </div>

            <div class="form-group">
                {{ form.email.label(class="form-label") }}
                {{ form.email(class="form-control", placeholder="Your email address") }}
                {% if form.email.errors %}
                    {% for error in form.email.errors %}<span class="form-error">{{ error }}</span>{% endfor %}
                {% endif %}
            </div>

            <div class="form-group">
                {{ form.bio.label(class="form-label") }}
                {{ form.bio(class="form-control textarea-bio", rows="4", placeholder="Tell us a little about yourself...") }}
                {% if form.bio.errors %}
                    {% for error in form.bio.errors %}<span class="form-error">{{ error }}</span>{% endfor %}
                {% endif %}
            </div>
        </fieldset>

        <fieldset class="form-fieldset">
            <legend>Change Password (Optional)</legend>
            <p class="text-muted small mb-3">Leave these fields blank if you don't want to change your password.</p>
            <div class="form-group">
                {{ form.current_password.label(class="form-label") }}
                {{ form.current_password(class="form-control", placeholder="Enter your current password") }}
                {% if form.current_password.errors %}
                    {% for error in form.current_password.errors %}<span class="form-error">{{ error }}</span>{% endfor %}
                {% endif %}
            </div>

            <div class="form-group">
                {{ form.new_password.label(class="form-label") }}
                {{ form.new_password(class="form-control", placeholder="Enter new password") }}
                {% if form.new_password.errors %}
                    {% for error in form.new_password.errors %}<span class="form-error">{{ error }}</span>{% endfor %}
                {% endif %}
            </div>

            <div class="form-group">
                {{ form.confirm_new_password.label(class="form-label") }}
                {{ form.confirm_new_password(class="form-control", placeholder="Confirm new password") }}
                {% if form.confirm_new_password.errors %}
                    {% for error in form.confirm_new_password.errors %}<span class="form-error">{{ error }}</span>{% endfor %}
                {% endif %}
            </div>
        </fieldset>

        <div class="form-group mt-4">
            {{ form.submit(class="btn btn-primary btn-block") }}
            <a href="{{ url_for('profile', username=current_user.username) }}" class="btn btn-outline-secondary btn-block mt-2">Cancel</a>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<style>
.edit-profile-form {
    max-width: 750px;
}
.form-fieldset {
    border: 1px solid var(--border-color);
    padding: 1.5rem;
    border-radius: var(--border-radius-lg);
    margin-bottom: 2rem;
}
.form-fieldset legend {
    font-size: 1.2rem;
    font-weight: 600;
    padding: 0 0.5rem;
    width: auto; /* Important for legend layout */
    color: var(--primary-color);
    margin-bottom: 1rem;
}
.textarea-bio {
    min-height: 100px;
}
.small.mb-3 {
    font-size: 0.85em;
    margin-bottom: 1rem !important;
}
.mt-4 { margin-top: 1.5rem !important; }
.mt-2 { margin-top: 0.5rem !important; }
.mr-2 { margin-right: 0.5rem !important; }
</style>
{% endblock %}